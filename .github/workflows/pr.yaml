name: pr check
on:
  pull_request:
    branches-ignore:
      - gh-pages
      - master

env:
  PR_BODY: ${{ github.event.pull_request.body }}
  PR_DESCRIPTION_RELEASES: |-

    === Releases
    1: test
    2: another-test

jobs:
  update-pr-description:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          persist-credentials: false

      - name: Set PR Description
        id: pr_description
        run: |
          PR_BODY_WITHOUT_RELEASES=$(echo "$PR_BODY" | sed -n '/=== Releases/q;p')

          PR_DESCRIPTION="${PR_BODY_WITHOUT_RELEASES}
          ${PR_DESCRIPTION_RELEASES}"

          echo "PR_DESCRIPTION<<EOF" >> $GITHUB_ENV
          echo "$PR_DESCRIPTION" >> $GITHUB_ENV
          echo "EOF" >> $GITHUB_ENV

      - uses: AsasInnab/pr-body-action@v1
        with:
          body: ${{ env.PR_DESCRIPTION }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
